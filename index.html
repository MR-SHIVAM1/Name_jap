<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡§ú‡§Ø ‡§∂‡•ç‡§∞‡•Ä ‡§∞‡§æ‡§ß‡•á - Japa Counter</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --saffron: #ff9933;
      --maroon: #7b1e1e;
      --cream: #fff7e6;
      --gold: #ffd700;
      --pink: #ff66b2;
      --purple: #9370db;
      --light-blue: #add8e6;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&family=Poppins:wght@300;400;600;700&display=swap');
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
  body {
  font-family: 'Poppins', 'Hind Siliguri', system-ui, sans-serif;
  margin: 0;
  color: #222;
  min-height: 100vh;
  overflow-x: hidden;
  background: url("Lake.png") no-repeat center center fixed;
  background-size: cover;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

    /* Heavenly background effects */
    .heavenly-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
    
    .cloud {
      position: absolute;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      filter: blur(15px);
    }
    
    .cloud:nth-child(1) {
      top: 10%;
      left: 20%;
      width: 150px;
      height: 60px;
    }
    
    .cloud:nth-child(2) {
      top: 25%;
      right: 15%;
      width: 200px;
      height: 80px;
    }
    
    .cloud:nth-child(3) {
      bottom: 20%;
      left: 10%;
      width: 180px;
      height: 70px;
    }
    
    .cloud:nth-child(4) {
      bottom: 30%;
      right: 20%;
      width: 120px;
      height: 50px;
    }
    
    /* Flower particles */
    .flower {
      position: absolute;
      font-size: 20px;
      color: #ff66b2;
      opacity: 0.7;
      z-index: -1;
      pointer-events: none;
    }
    
    /* Card styling */
    .card {
      width: min(680px, 92%);
      background: rgba(255, 247, 230, 0.9);
      border-radius: 24px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      padding: 30px;
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 230, 230, 0.2) 0%, transparent 70%);
      transform: rotate(30deg);
      z-index: 0;
    }
    
    h1 {
      margin: 10px 0 20px;
      font-weight: 800;
      color: var(--maroon);
      letter-spacing: 1px;
      text-align: center;
      font-size: 2.5rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 1;
    }
    
    .sub {
      color: #555;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.1rem;
      line-height: 1.5;
    }
    
    .row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    
    input[type=text], select {
      flex: 1;
      padding: 14px 18px;
      border: 1.5px solid #e1c4a9;
      border-radius: 16px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
    }
    
    input[type=text]:focus, select:focus {
      outline: none;
      border-color: var(--saffron);
      box-shadow: 0 0 0 3px rgba(255, 153, 51, 0.2);
    }
    
    .btn {
      cursor: pointer;
      border: 0;
      border-radius: 20px;
      padding: 18px 22px;
      font-weight: 700;
      font-size: 18px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }
    
    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }
    
    .btn:hover::after {
      animation: ripple 1s ease-out;
    }
    
    .btn.primary {
      background: linear-gradient(145deg, var(--saffron), #ff7733);
      color: #fff;
      box-shadow: 0 4px 15px rgba(255, 153, 51, 0.3);
    }
    
    .btn.primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(255, 153, 51, 0.4);
    }
    
    .btn.ghost {
      background: rgba(246, 246, 246, 0.8);
      color: #555;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }
    
    .btn.ghost:hover {
      background: rgba(255, 255, 255, 1);
      transform: translateY(-3px);
      box-shadow: 0 7px 15px rgba(0, 0, 0, 0.1);
    }
    
    .stats {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .pill {
      background: rgba(250, 243, 234, 0.8);
      border: 1px dashed #f1c089;
      padding: 12px 18px;
      border-radius: 999px;
      font-size: 0.9rem;
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }
    
    .pill:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .count-container {
      text-align: center;
      margin: 20px 0;
      position: relative;
    }
    
    .count {
      font-size: 5rem;
      font-weight: 800;
      line-height: 1;
      margin: 10px 0;
      color: var(--maroon);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      transition: all 0.5s ease;
    }
    
    .footer {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
      justify-content: center;
    }
    
    .note {
      font-size: 13px;
      color: #666;
      text-align: center;
      margin-top: 20px;
    }
    
    /* Color shower elements */
    .color-shower {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 100;
      display: none;
    }
    
    .color-particle {
      position: absolute;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      pointer-events: none;
    }

    
    /* Animations */
    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
      100% { transform: translateY(0) rotate(0deg); }
    }
    
    @keyframes ripple {
      0% {
        transform: scale(0, 0);
        opacity: 0.5;
      }
      20% {
        transform: scale(50, 50);
        opacity: 0.3;
      }
      100% {
        transform: scale(100, 100);
        opacity: 0;
      }
    }
    
    @keyframes countPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    
    @keyframes fadeInOut {
      0% { opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { opacity: 0; }
    }
    
    /* Responsive adjustments */
    @media (max-width: 600px) {
      .btn {
        width: 100%;
        justify-content: center;
      }
      
      .row {
        flex-direction: column;
      }
      
      .stats {
        gap: 10px;
      }
      
      .count {
        font-size: 4rem;
      }
      
      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Heavenly background -->
  <div class="heavenly-bg">
    <div class="cloud"></div>
    <div class="cloud"></div>
    <div class="cloud"></div>
    <div class="cloud"></div>
  </div>
  
  <!-- Color shower (initially hidden) -->
  <div class="color-shower" id="colorShower"></div>

  <div class=>
    <h1>‡§ú‡§Ø ‡§∂‡•ç‡§∞‡•Ä ‡§∞‡§æ‡§ß‡•á</h1>

    <div class="row">
      <input id="mantra" type="text" placeholder="‡§Ö‡§™‡§®‡§æ ‡§Æ‡§Ç‡§§‡•ç‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç (‡§â‡§¶‡§æ. ‡§∞‡§æ‡§ß‡§æ / Radha)" value="‡§∞‡§æ‡§ß‡§æ" />
      <select id="lang">
        <option value="hi-IN" selected>Hindi (hi-IN)</option>
        <option value="sa-IN">Sanskrit (sa-IN)</option>
        <option value="en-IN">English (en-IN)</option>
      </select>
    </div>

    <div class="stats">
      <span class="pill">‡§Æ‡§æ‡§≤‡§æ: <b id="malas">0</b></span>
      <span class="pill">‡§¶‡§æ‡§®‡•á: <b id="beads">0</b>/108</span>
      <span class="pill">‡§ï‡•Å‡§≤ ‡§ú‡§™: <b id="total">0</b></span>
      <span class="pill">‡§Ü‡§µ‡§æ‡§ú‡§º: <b id="micState">OFF</b></span>
    </div>

    <div class="count-container">
      <div class="count" id="bigCount">0</div>
    </div>

    <div class="row">
      <button class="btn primary" id="tapBtn">
        <i class="fas fa-hands-praying"></i> Count "Radha"
      </button>
      <button class="btn ghost" id="micBtn">
        <i class="fas fa-microphone"></i> Start Voice
      </button>
      <button class="btn ghost" id="resetBtn">
        <i class="fas fa-undo"></i> Reset
      </button>
    </div>

    
  </div>

  <script>
    // --- State ---
    const state = {
      total: 0,
      malas: 0,
      beads: 0,
      listening: false,
      lastResultIndex: 0,
    };

    // --- Elements ---
    const totalEl = document.getElementById('total');
    const malasEl = document.getElementById('malas');
    const beadsEl = document.getElementById('beads');
    const bigCountEl = document.getElementById('bigCount');
    const tapBtn = document.getElementById('tapBtn');
    const micBtn = document.getElementById('micBtn');
    const resetBtn = document.getElementById('resetBtn');
    const mantraInput = document.getElementById('mantra');
    const langSelect = document.getElementById('lang');
    const micStateEl = document.getElementById('micState');
    const colorShower = document.getElementById('colorShower');

    // Create floating flowers
    function createFlowers() {
      const heavenlyBg = document.querySelector('.heavenly-bg');
      const flowerSymbols = ['‚úø', '‚ùÄ', 'üå∏', 'üíÆ', 'üèµÔ∏è'];
      const colors = ['#ff66b2', '#9370db', '#ff9933', '#ffd700', '#add8e6'];
      
      for (let i = 0; i < 15; i++) {
        const flower = document.createElement('div');
        flower.className = 'flower';
        flower.innerHTML = flowerSymbols[Math.floor(Math.random() * flowerSymbols.length)];
        flower.style.left = Math.random() * 100 + 'vw';
        flower.style.top = Math.random() * 100 + 'vh';
        flower.style.color = colors[Math.floor(Math.random() * colors.length)];
        flower.style.fontSize = (Math.random() * 15 + 15) + 'px';
        flower.style.animation = `float ${(Math.random() * 10 + 10)}s ease-in-out infinite`;
        flower.style.animationDelay = Math.random() * 5 + 's';
        heavenlyBg.appendChild(flower);
      }
    }

    // Color shower animation
    function createColorShower() {
      colorShower.style.display = 'block';
      colorShower.innerHTML = '';
      
      const colors = ['#ff9933', '#7b1e1e', '#ff66b2', '#9370db', '#ffd700', '#add8e6'];
      const containerWidth = window.innerWidth;
      const containerHeight = window.innerHeight;
      
      for (let i = 0; i < 100; i++) {
        const particle = document.createElement('div');
        particle.className = 'color-particle';
        particle.style.left = Math.random() * containerWidth + 'px';
        particle.style.top = '-20px';
        particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        particle.style.width = (Math.random() * 20 + 10) + 'px';
        particle.style.height = particle.style.width;
        
        colorShower.appendChild(particle);
        
        // Animate particle falling
        const animationDuration = Math.random() * 3 + 2;
        particle.style.animation = `fadeInOut ${animationDuration}s ease-in forwards`;
        
        // Animate falling motion
        particle.animate(
          [
            { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
            { transform: `translate(${Math.random() * 100 - 50}px, ${containerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
          ],
          {
            duration: animationDuration * 1000,
            easing: 'cubic-bezier(0.2, 0.8, 0.3, 1)',
            fill: 'forwards'
          }
        );
      }
      
      // Hide shower after animation completes
      setTimeout(() => {
        colorShower.style.display = 'none';
      }, 3000);
    }

    // --- Persistence (localStorage) ---
    const LS_KEY = 'japaSession';
    function load() {
      const raw = localStorage.getItem(LS_KEY);
      if (!raw) return;
      try {
        const s = JSON.parse(raw);
        Object.assign(state, s);
        render();
      } catch {}
    }
    function save() {
      localStorage.setItem(LS_KEY, JSON.stringify({
        total: state.total, malas: state.malas, beads: state.beads
      }));
    }

    function render() {
      totalEl.textContent = state.total;
      malasEl.textContent = state.malas;
      beadsEl.textContent = state.beads;
      bigCountEl.textContent = state.total;
      micStateEl.textContent = state.listening ? 'ON' : 'OFF';
      tapBtn.innerHTML = `<i class="fas fa-hands-praying"></i> Count "${mantraInput.value || '‡§Æ‡§Ç‡§§‡•ç‡§∞'}"`;
    }

    function bump(n=1) {
      state.total += n;
      const before = state.beads;
      state.beads = (state.beads + n) % 108;
      
      // Animate the count
      bigCountEl.style.animation = 'none';
      setTimeout(() => {
        bigCountEl.style.animation = 'countPop 0.5s ease';
      }, 10);
      
      if (before + n >= 108 || (before < 108 && state.beads < before)) {
        state.malas += 1;
        try { navigator.vibrate && navigator.vibrate([30, 60, 30]); } catch {}
        // Create color shower when a mala is completed
        createColorShower();
      }
      save(); render();
    }

    tapBtn.addEventListener('click', () => {
      bump(1);
      // Small color effect on button click too
      createMiniColorEffect(tapBtn);
    });
    
    resetBtn.addEventListener('click', () => {
      if (!confirm('Reset counts?')) return;
      state.total = 0; state.malas = 0; state.beads = 0;
      save(); render();
    });
    mantraInput.addEventListener('input', render);

    // Mini color effect for button clicks
    function createMiniColorEffect(button) {
      const rect = button.getBoundingClientRect();
      const effect = document.createElement('div');
      effect.style.position = 'fixed';
      effect.style.left = rect.left + rect.width/2 + 'px';
      effect.style.top = rect.top + rect.height/2 + 'px';
      effect.style.width = '5px';
      effect.style.height = '5px';
      effect.style.borderRadius = '50%';
      effect.style.background = 'radial-gradient(circle, #ff9933, #ff66b2, #9370db)';
      effect.style.pointerEvents = 'none';
      effect.style.zIndex = '100';
      document.body.appendChild(effect);
      
      effect.animate([
        { transform: 'scale(1)', opacity: 1 },
        { transform: 'scale(20)', opacity: 0 }
      ], {
        duration: 800,
        easing: 'ease-out'
      });
      
      setTimeout(() => {
        document.body.removeChild(effect);
      }, 800);
    }

    // --- Voice recognition (Web Speech API) ---
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recog = null;

    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
    function buildMatcher() {
      const m = (mantraInput.value || '').trim();
      if (!m) return null;
      // Match both devanagari and latin if user typed latin "Radha" or "‡§∞‡§æ‡§ß‡§æ".
      const parts = [escapeRegExp(m)];
      // Friendly variants for Radha; extend as you like
      if (/^radha$/i.test(m)) parts.push('radhe', 'radhika');
      const pattern = `(?:\\b|\\s)(${parts.join('|')})(?:\\b|\\s)`;
      return new RegExp(pattern, 'gi');
    }

    function startMic() {
      if (!SR) {
        alert('SpeechRecognition not supported in this browser. Try Chrome/Edge.');
        return;
      }
      if (recog) { try { recog.stop(); } catch {} }
      recog = new SR();
      recog.continuous = true;
      recog.interimResults = true;
      recog.lang = langSelect.value;
      state.listening = true; render();

      recog.onresult = (e) => {
        // Count new final results only to avoid double counting
        for (let i = e.resultIndex; i < e.results.length; i++) {
          const res = e.results[i];
          if (!res.isFinal) continue;
          const text = res[0].transcript.trim();
          const re = buildMatcher();
          if (!re) continue;
          let hits = 0; let m;
          while ((m = re.exec(text)) !== null) hits++;
          if (hits > 0) bump(hits);
        }
      };
      recog.onerror = (ev) => {
        console.warn('SR error', ev.error);
      };
      recog.onend = () => {
        // Chrome stops after silence ‚Äî auto-restart if user still wants listening
        if (state.listening) {
          try { recog.start(); } catch {}
        }
      };
      try { recog.start(); } catch (e) { console.warn(e); }
    }

    function stopMic() {
      state.listening = false; render();
      if (recog) { try { recog.stop(); } catch {} }
    }

    micBtn.addEventListener('click', () => {
      if (state.listening) { 
        stopMic(); 
        micBtn.innerHTML = '<i class="fas fa-microphone"></i> Start Voice'; 
      }
      else { 
        startMic(); 
        micBtn.innerHTML = '<i class="fas fa-stop"></i> Stop Voice'; 
      }
    });

    langSelect.addEventListener('change', () => {
      if (state.listening) { stopMic(); startMic(); }
    });

    // Initialize
    load(); 
    render();
    createFlowers();
    
    // Add subtle background animation
    document.querySelectorAll('.cloud').forEach(cloud => {
      cloud.style.animation = `float ${15 + Math.random() * 10}s ease-in-out infinite`;
      cloud.style.animationDelay = `${Math.random() * 5}s`;
    });
  </script>
</body>
</html>